<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Word Garden</title>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Load the external banned words list -->
    <script src="banned_words.js"></script>

    <!-- Google Fonts: Noto Serif (Classic) and Lato (Clean) for Reggio feel -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Serif:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        /* Custom Reggio Emilia Color Palette & Styles */
        :root {
            --color-paper: #FDFBF7; /* Warm white paper look */
            --color-stone: #E5E5E5;
            --color-sage: #8DA399;  /* Calming green */
            --color-clay: #C29B82;  /* Earthy accent */
            --color-charcoal: #3E3E3E; /* Soft black for text */
            --color-leaf: #5F7A6E;
        }

        body {
            background-color: var(--color-paper);
            color: var(--color-charcoal);
            font-family: 'Lato', sans-serif;
            background-image: radial-gradient(#E5E5E5 1px, transparent 1px);
            background-size: 20px 20px; /* Subtle grid paper effect */
        }

        .font-serif {
            font-family: 'Noto Serif', serif;
        }

        /* Soft, organic animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        .animate-float {
            animation: float 4s ease-in-out infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--color-sage);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // TEACHER SETTINGS AREA
        // Edit these variables to adjust the app!
        // ==========================================
        const TEACHER_SETTINGS = {
            appTitle: "The Word Garden",
            welcomeMessage: "What will you discover today?",
            
            // Words for the "Discovery Word" feature AND the "Garden Games"
            discoveryWords: [
        
                "abate", "aberrant", "abscond", "abstemious", "admonish", "adulterate", "aesthetic", "aggregate", "alacrity", "alleviate", "amalgamate", "ambiguous", "ambivalent", "ameliorate", "anachronism", "analogous", "anarchy", "anomaly", "antipathy", "apathy", "appease", "apprehensive", "appropriate", "arbitrary", "arcane", "archaic", "ardent", "arduous", "articulate", "ascetic", "assiduous", "assuage", "astute", "audacious", "austere", "autonomous", "avarice", "banal", "belie", "belligerent", "benevolent", "benign", "bolster", "bombastic", "boorish", "burgeon", "buttress", "cacophony", "cajole", "callous", "candid", "capricious", "castigate", "catalyst", "caustic", "censure", "charlatan", "chicanery", "coalesce", "cogent", "commensurate", "compassion", "complacent", "compliant", "conciliatory", "condone", "confound", "congenial", "connoisseur", "conscientious", "consensus", "conspicuous", "contempt", "contentious", "contrite", "conventional", "convoluted", "copious", "cordial", "corroborate", "cosmopolitan", "covet", "crafty", "credible", "credulous", "criteria", "cryptic", "cursory", "curtail", "cynical", "daunt", "dearth", "debacle", "decorum", "defame", "defer", "deference", "deft", "degenerate", "deleterious", "delineate", "demagogue", "demure", "denigrate", "denounce", "depict", "deride", "derivative", "desiccate", "despondent", "despot", "destitute", "desultory", "deterrent", "detrimental", "deviate", "diatribe", "didactic", "diffident", "digress", "dilapidated", "dilatory", "diligent", "diminutive", "discern", "discreet", "discrepancy", "disdain", "disingenuous", "disparage", "disparate", "disseminate", "dissident", "dissipate", "dissolute", "dissonance", "distend", "divergent", "diverse", "divulge", "docile", "dogmatic", "dormant", "dubious", "duplicity", "duress", "ebullient", "eccentric", "eclectic", "efficacy", "effrontery", "egalitarian", "egregious", "elated", "eloquent", "elucidate", "elusive", "emaciated", "embellish", "emulate", "endemic", "enervate", "engender", "enhance", "enigma", "enmity", "enumerate", "ephemeral", "equanimity", "equivocal", "eradicate", "erratic", "erudite", "esoteric", "espouse", "ethereal", "euphemism", "evanescent", "exacerbate", "exacting", "exalt", "exasperate", "excerpt", "exemplary", "exhaustive", "exhort", "exonerate", "expedient", "expedite", "explicit", "exploit", "extraneous", "extravagant", "exuberant", "fabricate", "facetious", "facilitate", "fallacious", "fanatical", "fastidious", "fatuous", "feasible", "fervent", "fervid", "fickle", "fidelity", "figurative", "finesse", "flagrant", "flaunt", "flippant", "florid", "flounder", "fluctuate", "foment", "foppish", "forbearance", "forestall", "formidable", "fortuitous", "foster", "fractious", "fraudulent", "frenetic", "frivolous", "frugal", "fugitive", "furtive", "futile", "gainsay", "gallant", "garner", "garrulous", "gaudy", "genial", "germane", "glib", "grandiose", "gratuitous", "gregarious", "grievous", "guile", "gullible", "hackneyed", "haphazard", "hapless", "harangue", "harbinger", "hardy", "haughty", "hedonist", "hegemony", "heinous", "heresy", "heterogeneous", "hiatus", "hierarchy", "homogeneous", "hubris", "humane", "hyperbole", "hypocritical", "iconoclast", "idiosyncrasy", "ignoble", "ignominious", "illicit", "imminent", "immutable", "impartial", "impasse", "impeccable", "impede", "imperious", "impertinent", "impetuous", "impious", "implacable", "implicit", "implore", "imply", "impoverished", "imprudent", "impudent", "impugn", "inadvertent", "inane", "inarticulate", "incense", "incessant", "incisive", "incite", "inclination", "incoherent", "incompatible", "incongruous", "inconsequential", "incontrovertible", "incorrigible", "incredulous", "indefatigable", "indelible", "indigenous", "indigent", "indignant", "indolent", "indomitable", "indulgent", "industrious", "ineffable", "inept", "inert", "inevitable", "inexorable", "infamous", "infer", "infinitesimal", "infirmity", "inflated", "ingenious", "ingenuous", "inherent", "inhibit", "inimical", "iniquity", "initiate", "injurious", "innate", "innocuous", "innovation", "innuendo", "inquisitive", "insatiable", "insidious", "insinuate", "insipid", "insolent", "instigate", "insular", "insuperable", "insurgent", "integral", "integrity", "intemperate", "intermittent", "intractable", "intransigent", "intrepid", "intricate", "intrinsic", "introspective", "inundate", "inure", "invective", "inveterate", "invidious", "invincible", "irate", "irascible", "iridescent", "ironic", "irrational", "irrefutable", "irreproachable", "irresolute", "irreverent", "itinerant", "jaded", "jargon", "jettison", "jocular", "jovial", "judicious", "juxtapose", "kindle", "kinetic", "labyrinth", "lackluster", "laconic", "languid", "larceny", "largess", "latent", "laud", "lavish", "lax", "legacy", "lenient", "lethargic", "levity", "liberal", "libertine", "lithe", "lofty", "loquacious", "lucid", "lucrative", "ludicrous", "luminous", "magnanimous", "maladroit", "malaise", "malevolent", "malicious", "malign", "malleable", "mandate", "manifest", "manifold", "marginal", "marshal", "martial", "martyr", "materialism", "matriarch", "maudlin", "maverick", "maxim", "meager", "meander", "mediocre", "melancholy", "mentor", "mercenary", "mercurial", "meretricious", "meritorious", "methodical", "meticulous", "mettle", "mince", "mitigate", "mnemonic", "mobility", "mock", "moderate", "modest", "mollify", "momentous", "monotonous", "morose", "mortal", "mundane", "munificent", "myriad", "nadir", "naive", "narcissist", "nascent", "nebulous", "nefarious", "negligent", "nemesis", "neophyte", "neutral", "nocturnal", "nonchalant", "nostalgia", "notable", "notorious", "novel", "novice", "noxious", "nuance", "nullify", "obdurate", "obedient", "obese", "obfuscate", "objective", "obligatory", "oblique", "oblivious", "obnoxious", "obscure", "obsequious", "obsolete", "obstinate", "obtuse", "obviate", "odious", "officious", "ominous", "omnipotent", "omniscient", "onerous", "opaque", "opulent", "orthodox", "oscillate", "ostentatious", "ostracize", "pacify", "painstaking", "palatable", "pallid", "paltry", "panacea", "paradigm", "paradox", "paragon", "paramount", "pariah", "parody", "parry", "parsimonious", "partisan", "patent", "paternal", "pathetic", "pathos", "patriarch", "patrician", "patronize", "paucity", "pedantic", "pedestrian", "penchant", "penitent", "pensive", "penurious", "perfidious", "perfunctory", "peripheral", "perjury", "permeate", "pernicious", "perpetual", "perplexed", "persevere", "pertinent", "perturb", "peruse", "pervasive", "pessimism", "petulant", "philanthropist", "philistine", "phlegmatic", "piety", "pinnacle", "pious", "pivotal", "placate", "placid", "plagiarize", "plaintiff", "platitude", "plausible", "plebeian", "plethora", "pliable", "plunder", "poignant", "polarize", "polemic", "ponderous", "portent", "posthumous", "potent", "pragmatic", "preamble", "precarious", "precede", "precedent", "precept", "precipitate", "precipitous", "preclude", "precocious", "predecessor", "predilection", "preeminent", "preempt", "prejudice", "prelude", "preposterous", "presage", "prescient", "presumptuous", "pretentious", "prevail", "prevaricate", "primordial", "pristine", "privation", "prodigal", "prodigious", "profane", "proficient", "profligate", "profound", "profuse", "progenitor", "prohibitive", "proliferate", "prolific", "prolix", "propensity", "prophetic", "propitious", "proponent", "propriety", "prosaic", "proscribe", "prospective", "prostrate", "prot√©g√©", "protract", "provincial", "provisional", "provoke", "prowess", "prudent", "prurient", "puerile", "pugnacious", "punctilious", "pungent", "punitive", "quaint", "qualitative", "quandary", "quarantine", "querulous", "quiescent", "quintessential", "quixotic", "quizzical", "quotidian", "ramble", "rancorous", "rantankerous", "rapacious", "ratify", "raucous", "raze", "rebuke", "recalcitrant", "recant", "receptive", "reclusive", "recompense", "reconcile", "recondite", "redundant", "refute", "regale", "relegate", "relent", "relevant", "relinquish", "reluctant", "remedial", "reminisce", "remiss", "remnant", "remonstrate", "remorse", "renounce", "renovate", "repartee", "repeal", "replete", "replicate", "reprehensible", "reprieve", "reprimand", "reproach", "reprobate", "repudiate", "repugnant", "reputable", "rescind", "reserve", "resigned", "resilient", "resolute", "resolve", "resonant", "respite", "resplendent", "restitution", "restive", "restrained", "reticent", "retract", "retrench", "retrospect", "reverent", "revere", "rhetoric", "rigorous", "robust", "rogue", "rotund", "rubble", "rudimentary", "rue", "ruminate", "rustic", "ruthless", "saccharine", "sacrilege", "sacrosanct", "sagacious", "sage", "salacious", "salient", "salubrious", "salutary", "sanction", "sanguine", "sardonic", "sate", "saturate", "savant", "savor", "scanty", "scathing", "schism", "scintillate", "scoff", "scrupulous", "scrutinize", "scurrilous", "secrete", "secular", "sedentary", "sedition", "seismic", "seminal", "sensory", "sensual", "sensuous", "sentient", "serene", "servile", "severe", "shrewd", "singular", "sinister", "skeptic", "slander", "sloth", "slovenly", "smug", "sobriety", "solace", "solemnity", "solicit", "solicitous", "solitude", "solvent", "somatic", "somber", "somnolent", "sophomoric", "soporific", "sordid", "sovereign", "sparse", "spartan", "specious", "spectrum", "speculate", "spontaneous", "sporadic", "spurious", "spurn", "squalid", "squander", "stagnant", "staid", "static", "steadfast", "stoic", "stolid", "strenuous", "strident", "stringent", "stymie", "subdued", "subjective", "subjugate", "sublime", "subordinate", "subsequent", "subservient", "substantiate", "subtle", "subversive", "succinct", "succumb", "suffrage", "sullen", "sultry", "summarily", "sumptuous", "superfluous", "suppress", "surfeit", "surly", "surmise", "surreptitious", "susceptible", "sycophant", "symmetry", "synopsis", "synthesis", "tacit", "taciturn", "taint", "tangential", "tangible", "tantamount", "tautology", "tedious", "temerity", "temperate", "tenable", "tenacious", "tentative", "tenuous", "tepid", "terse", "thwart", "timorous", "tirade", "toady", "tome", "torpid", "torrid", "totalitarian", "tractable", "tranquil", "transcend", "transgress", "transient", "transparent", "travesty", "tremulous", "trenchant", "trepidation", "trite", "trivial", "truculence", "truncate", "tumultuous", "turbulence", "turgid", "turmoil", "turpitude", "tutelage", "tyranny", "ubiquitous", "ultimate", "umbrage", "unassuming", "uncanny", "unctuous", "undermine", "undulate", "unequivocal", "unfettered", "uniformity", "unilateral", "unimpeachable", "unique", "universal", "unkempt", "unobtrusive", "unprecedented", "unpretentious", "unruly", "unsavory", "unscrupulous", "unwieldy", "unwitting", "upbraid", "urbane", "usurp", "utilitarian", "utopia", "vacillate", "vacuous", "vagrant", "vague", "vain", "valedictory", "validate", "valor", "vanquish", "vapid", "variable", "variegated", "vehement", "venal", "veneer", "venerable", "venerate", "veracity", "verbose", "verdant", "versatile", "vex", "viable", "vicarious", "vicissitude", "vigilant", "vigor", "vile", "vilify", "vindicate", "vindictive", "virtuoso", "virulent", "viscous", "vitriolic", "vituperate", "vivacious", "vociferous", "volatile", "volition", "voluble", "voracious", "wane", "wanton", "wary", "waver", "whimsical", "willful", "wily", "wistful", "withdrawn", "withhold", "witticism", "woe", "wrath", "wry", "zealot", "zealous", "zenith",
                
                "curious", "nature", "create", "observe", "wonder", 
                "habitat", "journey", "ripple", "breeze", "meadow",
                "canopy", "blossom", "explore", "quiet", "listen",
                "reflect", "grow", "shadow", "light", "texture"
            ],

            // INTERNAL BASIC SAFETY FILTER
            // This is a small backup list. 
            // The MAIN list should go in "banned_words.js"
            basicBannedWords: [
                "stupid", "idiot", "dumb", "hate", "kill", "death", 
                "violence", "weapon", "sex", "nude", "naked"
            ],

            // Gamification: Badges for collecting words
            badges: [
                { count: 1, name: "Seedling", icon: "üå±", description: "You planted your first word!" },
                { count: 5, name: "Sprout", icon: "üåø", description: "Your vocabulary is growing." },
                { count: 10, name: "Gardener", icon: "üåª", description: "You are tending to many ideas." },
                { count: 20, name: "Botanist", icon: "üå≥", description: "A true expert of the word garden." },
                { count: 50, name: "Forest", icon: "üå≤", description: "An ecosystem of knowledge!" }
            ],

            // Audio settings
            enableSound: true
        };

        const { useState, useEffect, useRef } = React;

        // ==========================================
        // INTERNAL ICONS (Replaces External Library)
        // ==========================================
        const Icons = {
            Search: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            BookOpen: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>,
            Star: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill={props.fill || "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
            Volume2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>,
            Leaf: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"></path><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"></path></svg>,
            Award: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>,
            RotateCcw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M1 4v6h6"></path><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>,
            Sparkles: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></svg>,
            Quote: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"></path><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"></path></svg>,
            Puzzle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M8 12h8"></path><path d="M12 8v8"></path></svg>
        };

        // ==========================================
        // MAIN APP COMPONENT
        // ==========================================
        function App() {
            // --- State Variables ---
            const [searchTerm, setSearchTerm] = useState("");
            const [definition, setDefinition] = useState(null);
            const [relatedWords, setRelatedWords] = useState({ synonyms: [], antonyms: [] });
            const [examples, setExamples] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            
            // Collection & Progress (Loaded from Local Storage)
            const [collection, setCollection] = useState(() => {
                const saved = localStorage.getItem('wordGardenCollection');
                return saved ? JSON.parse(saved) : [];
            });
            
            // "Discovery Word" State
            const [discoveryWord, setDiscoveryWord] = useState("");

            // View State: 'search', 'collection', 'badges', 'challenges'
            const [view, setView] = useState('search');

            // Game State
            const [gameData, setGameData] = useState({
                question: null,
                targetWord: null,
                options: [],
                status: 'idle', // idle, playing, correct, incorrect
                score: 0
            });
            const [gameLoading, setGameLoading] = useState(false);

            // --- Effects ---
            
            // Save collection to local storage whenever it changes
            useEffect(() => {
                localStorage.setItem('wordGardenCollection', JSON.stringify(collection));
            }, [collection]);

            // Set a random discovery word on load
            useEffect(() => {
                const randomWord = TEACHER_SETTINGS.discoveryWords[Math.floor(Math.random() * TEACHER_SETTINGS.discoveryWords.length)];
                setDiscoveryWord(randomWord);
            }, []);

            // --- Functions ---

            // Helper to get ALL banned words (internal + external)
            const getAllBannedWords = () => {
                const externalList = window.BANNED_WORD_LIST || [];
                const internalList = TEACHER_SETTINGS.basicBannedWords || [];
                return [...internalList, ...externalList];
            };

            // Helper to extract synonyms and antonyms from API data
            const extractRelatedWords = (data) => {
                let syns = new Set();
                let ants = new Set();

                if (data.meanings) {
                    data.meanings.forEach(m => {
                        if (m.synonyms) m.synonyms.forEach(s => syns.add(s));
                        if (m.antonyms) m.antonyms.forEach(a => ants.add(a));
                        
                        if (m.definitions) {
                            m.definitions.forEach(d => {
                                if (d.synonyms) d.synonyms.forEach(s => syns.add(s));
                                if (d.antonyms) d.antonyms.forEach(a => ants.add(a));
                            });
                        }
                    });
                }
                return { synonyms: Array.from(syns), antonyms: Array.from(ants) };
            };

            // Helper to extract example sentences
            const extractExamples = (data) => {
                let ex = [];
                if (data.meanings) {
                    data.meanings.forEach(m => {
                        if (m.definitions) {
                            m.definitions.forEach(d => {
                                if (d.example) ex.push(d.example);
                            });
                        }
                    });
                }
                return ex.slice(0, 3); // Return top 3 examples
            };

            // Refactored Search Function: Accepts an optional override word
            const handleSearch = async (e, wordOverride = null) => {
                if (e) e.preventDefault();
                
                // Determine which word we are searching for
                const wordToSearch = wordOverride || searchTerm;

                if (!wordToSearch || !wordToSearch.trim()) return;

                // Sync the search bar if we are using an override (e.g. from clicking a pill or card)
                if (wordOverride) {
                    setSearchTerm(wordOverride);
                }

                // SAFETY CHECK: Profanity Filter
                // IMPROVED LOGIC: Uses word boundaries (\b) to avoid the "Scunthorpe problem"
                // This allows "shout" even if "ho" is banned, and "beautiful" even if "tit" is banned.
                const cleanSearch = wordToSearch.trim().toLowerCase();
                const bannedList = getAllBannedWords();
                
                const isBanned = bannedList.some(badWord => {
                    // Escape potential special characters in user input just in case
                    const safeBadWord = badWord.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                    // Regex: \b means "word boundary"
                    const regex = new RegExp(`\\b${safeBadWord}\\b`, 'i');
                    return regex.test(cleanSearch);
                });

                if (isBanned) {
                    setError("That word doesn't seem to fit in our garden. Let's try a different one.");
                    setDefinition(null);
                    setLoading(false);
                    playSound('error');
                    return;
                }

                setLoading(true);
                setError(null);
                setDefinition(null);
                setRelatedWords({ synonyms: [], antonyms: [] });
                setExamples([]);
                setView('search');

                try {
                    // Using the Free Dictionary API
                    const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${wordToSearch}`);
                    
                    if (!response.ok) {
                        throw new Error("Word not found");
                    }

                    const data = await response.json();
                    const entry = data[0];
                    setDefinition(entry);
                    setRelatedWords(extractRelatedWords(entry));
                    setExamples(extractExamples(entry));
                    playSound('pop');
                } catch (err) {
                    setError("Hmm, we couldn't find that word in our garden. Try checking the spelling.");
                } finally {
                    setLoading(false);
                }
            };

            // --- GAME LOGIC: The Missing Petal ---
            const startChallenge = async () => {
                setGameLoading(true);
                setGameData(prev => ({ ...prev, status: 'idle', question: null, options: [] }));

                const wordList = TEACHER_SETTINGS.discoveryWords;
                let sentenceFound = false;
                let attempts = 0;

                while (!sentenceFound && attempts < 10) {
                    attempts++;
                    // Pick random word
                    const target = wordList[Math.floor(Math.random() * wordList.length)];
                    
                    try {
                        const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${target}`);
                        if (!response.ok) continue;

                        const data = await response.json();
                        const examples = extractExamples(data[0]);

                        if (examples.length > 0) {
                            // Found a valid sentence!
                            // Pick one example
                            let sentence = examples[0];
                            
                            // Hide the word (case insensitive regex replacement)
                            const regex = new RegExp(`\\b${target}\\b`, 'gi');
                            // Ensure the word actually exists in the sentence (sometimes examples are weird)
                            if (!regex.test(sentence)) continue;

                            const maskedSentence = sentence.replace(regex, "_______");

                            // Generate 3 distractors
                            const options = new Set();
                            options.add(target);
                            while(options.size < 4) {
                                const distractor = wordList[Math.floor(Math.random() * wordList.length)];
                                if (distractor !== target) options.add(distractor);
                            }

                            // Shuffle options
                            const shuffledOptions = Array.from(options).sort(() => Math.random() - 0.5);

                            setGameData(prev => ({
                                ...prev,
                                targetWord: target,
                                question: maskedSentence,
                                options: shuffledOptions,
                                status: 'playing'
                            }));
                            sentenceFound = true;
                        }
                    } catch (e) {
                        console.error("Game fetch error", e);
                    }
                }

                if (!sentenceFound) {
                    alert("Could not start game right now. Please check your internet or try again.");
                }
                setGameLoading(false);
            };

            const handleGameAnswer = (selectedWord) => {
                if (gameData.status !== 'playing') return;

                if (selectedWord.toLowerCase() === gameData.targetWord.toLowerCase()) {
                    setGameData(prev => ({
                        ...prev,
                        status: 'correct',
                        score: prev.score + 1
                    }));
                    playSound('success');
                } else {
                    setGameData(prev => ({
                        ...prev,
                        status: 'incorrect'
                    }));
                    playSound('error');
                }
            };

            // --- Existing functions ---

            const addToCollection = () => {
                if (!definition) return;
                
                // Avoid duplicates
                if (collection.some(item => item.word === definition.word)) {
                    playSound('error');
                    return;
                }

                const newEntry = {
                    word: definition.word,
                    partOfSpeech: definition.meanings[0].partOfSpeech,
                    definition: definition.meanings[0].definitions[0].definition,
                    timestamp: new Date().toISOString()
                };

                setCollection([newEntry, ...collection]);
                playSound('success');
            };

            const removeFromCollection = (wordToRemove) => {
                setCollection(collection.filter(item => item.word !== wordToRemove));
            };

            const resetProgress = () => {
                if (confirm("Are you sure you want to clear your entire garden? This cannot be undone.")) {
                    setCollection([]);
                    localStorage.removeItem('wordGardenCollection');
                    setDefinition(null);
                    setSearchTerm("");
                    playSound('trash');
                }
            };

            const playSound = (type) => {
                if (!TEACHER_SETTINGS.enableSound) return;
                
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                
                osc.connect(gain);
                gain.connect(ctx.destination);

                const now = ctx.currentTime;
                
                if (type === 'pop') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, now);
                    osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                } else if (type === 'success') {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(300, now);
                    osc.frequency.linearRampToValueAtTime(500, now + 0.1);
                    osc.frequency.linearRampToValueAtTime(800, now + 0.3);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                    osc.start(now);
                    osc.stop(now + 0.5);
                } else if (type === 'error') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, now);
                    osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0.01, now + 0.2);
                    osc.start(now);
                    osc.stop(now + 0.2);
                }
            };

            const playPronunciation = (audioUrl) => {
                if (audioUrl) {
                    new Audio(audioUrl).play();
                } else {
                    alert("No audio recording available for this word.");
                }
            };

            // Calculate current badge
            const getCurrentBadge = () => {
                const count = collection.length;
                // Find the highest badge where count >= badge.count
                let current = TEACHER_SETTINGS.badges[0];
                for (let badge of TEACHER_SETTINGS.badges) {
                    if (count >= badge.count) {
                        current = badge;
                    }
                }
                return current;
            };

            const currentBadge = getCurrentBadge();

            // --- Render Components ---

            return (
                <div className="max-w-6xl mx-auto p-4 min-h-screen flex flex-col font-sans text-gray-700">
                    
                    {/* Header */}
                    <header className="flex flex-col md:flex-row justify-between items-center py-6 border-b-2 border-stone-200 mb-8">
                        <div className="flex items-center gap-3 mb-4 md:mb-0">
                            <div className="bg-[#8DA399] p-3 rounded-full text-white animate-float">
                                <Icons.Leaf size={32} />
                            </div>
                            <div>
                                <h1 className="text-3xl font-serif text-[#5F7A6E] font-bold">{TEACHER_SETTINGS.appTitle}</h1>
                                <p className="text-sm text-gray-500 italic">{TEACHER_SETTINGS.welcomeMessage}</p>
                            </div>
                        </div>

                        {/* Navigation / Stats */}
                        <div className="flex gap-4">
                            <button 
                                onClick={() => setView('search')}
                                className={`px-4 py-2 rounded-lg transition-all ${view === 'search' ? 'bg-[#C29B82] text-white shadow-md' : 'bg-white hover:bg-stone-100'}`}
                            >
                                Search
                            </button>
                            <button 
                                onClick={() => setView('collection')}
                                className={`px-4 py-2 rounded-lg transition-all flex items-center gap-2 ${view === 'collection' ? 'bg-[#8DA399] text-white shadow-md' : 'bg-white hover:bg-stone-100'}`}
                            >
                                <Icons.BookOpen size={18} /> Collection ({collection.length})
                            </button>
                            <button 
                                onClick={() => setView('badges')}
                                className={`px-4 py-2 rounded-lg transition-all flex items-center gap-2 ${view === 'badges' ? 'bg-[#EBC45D] text-white shadow-md' : 'bg-white hover:bg-stone-100'}`}
                            >
                                <Icons.Award size={18} /> Badges
                            </button>
                            <button 
                                onClick={() => setView('challenges')}
                                className={`px-4 py-2 rounded-lg transition-all flex items-center gap-2 ${view === 'challenges' ? 'bg-[#5F7A6E] text-white shadow-md' : 'bg-white hover:bg-stone-100'}`}
                            >
                                <Icons.Puzzle size={18} /> Games
                            </button>
                        </div>
                    </header>

                    {/* Main Content Area */}
                    <main className="flex-grow">
                        
                        {/* VIEW: SEARCH */}
                        {view === 'search' && (
                            <div className="fade-in">
                                {/* Search Bar */}
                                <form onSubmit={(e) => handleSearch(e)} className="relative max-w-2xl mx-auto mb-12">
                                    <input 
                                        type="text" 
                                        placeholder="Type a word to plant in your garden..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        className="w-full p-4 pl-6 pr-12 text-xl rounded-2xl border-2 border-[#8DA399]/30 focus:border-[#8DA399] focus:outline-none shadow-sm transition-all bg-white/80 backdrop-blur"
                                    />
                                    <button 
                                        type="submit"
                                        className="absolute right-3 top-3 p-2 bg-[#8DA399] text-white rounded-xl hover:bg-[#5F7A6E] transition-colors"
                                    >
                                        <Icons.Search size={24} />
                                    </button>
                                </form>

                                {/* Discovery Word (Only show if no search result yet) */}
                                {!definition && !loading && !error && (
                                    <div className="text-center p-8 bg-white/50 rounded-3xl border border-stone-100 max-w-md mx-auto">
                                        <p className="uppercase tracking-widest text-xs font-bold text-[#C29B82] mb-2">Discovery Word</p>
                                        <h2 className="text-4xl font-serif text-[#5F7A6E] mb-4 cursor-pointer hover:underline" onClick={() => handleSearch(null, discoveryWord)}>
                                            {discoveryWord}
                                        </h2>
                                        <p className="text-gray-500 text-sm">Tap the word to look it up!</p>
                                    </div>
                                )}

                                {/* Loading State */}
                                {loading && (
                                    <div className="text-center py-12">
                                        <div className="animate-spin inline-block w-8 h-8 border-4 border-[#8DA399] border-t-transparent rounded-full"></div>
                                        <p className="mt-4 text-gray-500">Digging through the soil...</p>
                                    </div>
                                )}

                                {/* Error State */}
                                {error && (
                                    <div className="bg-red-50 border border-red-100 text-red-600 p-6 rounded-2xl text-center max-w-md mx-auto">
                                        <p>{error}</p>
                                    </div>
                                )}

                                {/* Definition Layout: Two Columns on Desktop */}
                                {definition && (
                                    <div className="grid grid-cols-1 md:grid-cols-12 gap-6 items-start animate-fade-in">
                                        
                                        {/* LEFT COLUMN: Seeds & Weeds & Examples */}
                                        <div className="md:col-span-4 order-2 md:order-1">
                                            
                                            {/* Thesaurus Box */}
                                            <div className="bg-white p-6 rounded-3xl shadow-sm border border-stone-100 mb-6">
                                                <h3 className="font-serif text-xl text-[#5F7A6E] mb-6 flex items-center gap-2 border-b border-stone-100 pb-2">
                                                    <Icons.Sparkles size={20}/> Seeds & Weeds
                                                </h3>
                                                
                                                <div className="space-y-6">
                                                    {/* Synonyms */}
                                                    <div>
                                                        <h4 className="text-xs uppercase tracking-wide text-[#8DA399] font-bold mb-3 flex items-center gap-2">
                                                            <span>üå±</span> Seeds (Synonyms)
                                                        </h4>
                                                        <div className="flex flex-wrap gap-2">
                                                            {relatedWords.synonyms.length > 0 ? (
                                                                relatedWords.synonyms.slice(0, 15).map((word, i) => (
                                                                    <button 
                                                                        key={i} 
                                                                        onClick={() => handleSearch(null, word)}
                                                                        className="bg-stone-50 border border-[#8DA399]/30 text-[#5F7A6E] px-2 py-1 rounded-lg text-sm hover:bg-[#8DA399] hover:text-white transition-colors text-left"
                                                                    >
                                                                        {word}
                                                                    </button>
                                                                ))
                                                            ) : (
                                                                <span className="text-gray-400 text-sm italic">No seeds found.</span>
                                                            )}
                                                        </div>
                                                    </div>

                                                    {/* Antonyms */}
                                                    <div>
                                                        <h4 className="text-xs uppercase tracking-wide text-[#C29B82] font-bold mb-3 flex items-center gap-2">
                                                            <span>üçÇ</span> Weeds (Antonyms)
                                                        </h4>
                                                        <div className="flex flex-wrap gap-2">
                                                            {relatedWords.antonyms.length > 0 ? (
                                                                relatedWords.antonyms.slice(0, 15).map((word, i) => (
                                                                    <button 
                                                                        key={i} 
                                                                        onClick={() => handleSearch(null, word)}
                                                                        className="bg-stone-50 border border-[#C29B82]/30 text-[#C29B82] px-2 py-1 rounded-lg text-sm hover:bg-[#C29B82] hover:text-white transition-colors text-left"
                                                                    >
                                                                        {word}
                                                                    </button>
                                                                ))
                                                            ) : (
                                                                <span className="text-gray-400 text-sm italic">No weeds found.</span>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Example Sentences Box (In the Wild) */}
                                            {examples.length > 0 && (
                                                <div className="bg-white p-6 rounded-3xl shadow-sm border border-stone-100">
                                                    <h3 className="font-serif text-xl text-[#5F7A6E] mb-4 flex items-center gap-2 border-b border-stone-100 pb-2">
                                                        <Icons.Quote size={20}/> In the Wild
                                                    </h3>
                                                    <ul className="space-y-4">
                                                        {examples.map((ex, i) => (
                                                            <li key={i} className="text-stone-600 italic text-sm border-l-2 border-[#8DA399] pl-3">
                                                                "{ex}"
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            )}
                                        </div>

                                        {/* RIGHT COLUMN: Main Definition */}
                                        <div className="md:col-span-8 order-1 md:order-2 bg-white p-8 rounded-3xl shadow-lg border border-stone-100 relative overflow-hidden">
                                            {/* Decorative leaf bg */}
                                            <div className="absolute -right-10 -top-10 text-stone-50 pointer-events-none">
                                                <Icons.Leaf size={200} />
                                            </div>

                                            <div className="relative z-10">
                                                <div className="flex justify-between items-start mb-6">
                                                    <div>
                                                        <h2 className="text-5xl font-serif text-[#3E3E3E] mb-2 capitalize">{definition.word}</h2>
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-[#C29B82] font-mono italic">{definition.phonetic || ""}</span>
                                                            {definition.phonetics.find(p => p.audio) && (
                                                                <button 
                                                                    onClick={() => playPronunciation(definition.phonetics.find(p => p.audio).audio)}
                                                                    className="p-1.5 rounded-full bg-stone-100 hover:bg-[#8DA399] hover:text-white transition-colors"
                                                                    title="Listen"
                                                                >
                                                                    <Icons.Volume2 size={16} />
                                                                </button>
                                                            )}
                                                        </div>
                                                    </div>
                                                    
                                                    <button 
                                                        onClick={addToCollection}
                                                        disabled={collection.some(item => item.word === definition.word)}
                                                        className={`group flex flex-col items-center gap-1 ${collection.some(item => item.word === definition.word) ? 'opacity-50 cursor-not-allowed' : ''}`}
                                                    >
                                                        <div className="p-3 bg-[#EBC45D] text-white rounded-full shadow-md transform transition group-hover:scale-110">
                                                            <Icons.Star size={24} fill={collection.some(item => item.word === definition.word) ? "white" : "none"} />
                                                        </div>
                                                        <span className="text-xs font-bold text-[#C29B82]">
                                                            {collection.some(item => item.word === definition.word) ? 'Saved' : 'Save'}
                                                        </span>
                                                    </button>
                                                </div>

                                                <div className="space-y-6">
                                                    {definition.meanings.map((meaning, idx) => (
                                                        <div key={idx} className="border-l-4 border-[#8DA399]/30 pl-4">
                                                            <span className="inline-block bg-[#8DA399]/10 text-[#5F7A6E] px-2 py-1 rounded text-sm font-bold mb-2">
                                                                {meaning.partOfSpeech}
                                                            </span>
                                                            <ul className="list-disc list-inside space-y-2 text-lg text-gray-600 mt-2">
                                                                {meaning.definitions.slice(0, 3).map((def, dIdx) => (
                                                                    <li key={dIdx}>{def.definition}</li>
                                                                ))}
                                                            </ul>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* VIEW: COLLECTION */}
                        {view === 'collection' && (
                            <div className="fade-in">
                                <h2 className="text-3xl font-serif text-[#5F7A6E] mb-6 text-center">My Word Collection</h2>
                                
                                {collection.length === 0 ? (
                                    <div className="text-center py-20 bg-white/50 rounded-3xl border-2 border-dashed border-stone-300">
                                        <Icons.Leaf size={48} className="mx-auto text-stone-300 mb-4" />
                                        <p className="text-gray-500">Your garden is empty. Go search for words to plant!</p>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {collection.map((item, idx) => (
                                            <div 
                                                key={idx} 
                                                onClick={() => handleSearch(null, item.word)}
                                                className="bg-white p-6 rounded-2xl shadow-sm border-b-4 border-[#C29B82] hover:-translate-y-1 transition-transform relative group cursor-pointer"
                                            >
                                                <div className="flex justify-between items-start mb-2">
                                                    <h3 className="text-xl font-bold font-serif capitalize">{item.word}</h3>
                                                    <span className="text-xs text-[#8DA399] border border-[#8DA399] px-1.5 py-0.5 rounded">{item.partOfSpeech}</span>
                                                </div>
                                                <p className="text-gray-600 text-sm line-clamp-3 mb-4">{item.definition}</p>
                                                
                                                {/* Delete button: stopPropagation prevents opening the card */}
                                                <button 
                                                    onClick={(e) => { e.stopPropagation(); removeFromCollection(item.word); }}
                                                    className="absolute bottom-4 right-4 text-stone-300 hover:text-red-400 transition-colors z-10"
                                                    title="Remove from collection"
                                                >
                                                    <Icons.Trash2 size={18} />
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {/* VIEW: BADGES */}
                        {view === 'badges' && (
                            <div className="fade-in max-w-3xl mx-auto">
                                <div className="text-center mb-10">
                                    <h2 className="text-3xl font-serif text-[#5F7A6E] mb-2">Explorer Badges</h2>
                                    <p className="text-gray-600">You have collected <strong className="text-[#C29B82] text-xl">{collection.length}</strong> words.</p>
                                </div>

                                <div className="space-y-4">
                                    {TEACHER_SETTINGS.badges.map((badge, idx) => {
                                        const isUnlocked = collection.length >= badge.count;
                                        return (
                                            <div 
                                                key={idx} 
                                                className={`flex items-center p-4 rounded-2xl border-2 transition-all ${isUnlocked ? 'bg-white border-[#EBC45D]' : 'bg-stone-100 border-stone-200 opacity-60'}`}
                                            >
                                                <div className={`w-16 h-16 rounded-full flex items-center justify-center text-3xl mr-6 ${isUnlocked ? 'bg-[#EBC45D]/20' : 'bg-stone-200 grayscale'}`}>
                                                    {badge.icon}
                                                </div>
                                                <div className="flex-grow">
                                                    <h3 className={`text-xl font-bold ${isUnlocked ? 'text-gray-800' : 'text-gray-400'}`}>
                                                        {badge.name}
                                                    </h3>
                                                    <p className="text-sm text-gray-500">{badge.description}</p>
                                                </div>
                                                <div className="text-right">
                                                    <span className={`text-sm font-mono px-2 py-1 rounded ${isUnlocked ? 'bg-[#EBC45D] text-white' : 'bg-stone-300 text-gray-500'}`}>
                                                        {isUnlocked ? 'UNLOCKED' : `${badge.count} words`}
                                                    </span>
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            </div>
                        )}

                        {/* VIEW: CHALLENGES */}
                        {view === 'challenges' && (
                            <div className="fade-in max-w-2xl mx-auto">
                                <div className="text-center mb-8">
                                    <h2 className="text-3xl font-serif text-[#5F7A6E] mb-2">Garden Games</h2>
                                    <p className="text-gray-600">Test your knowledge and collect petals!</p>
                                    <div className="mt-4 inline-block bg-[#EBC45D] text-white px-4 py-2 rounded-full font-bold">
                                        Petals Collected: {gameData.score}
                                    </div>
                                </div>

                                <div className="bg-white rounded-3xl shadow-lg border border-stone-100 p-8 text-center relative overflow-hidden">
                                    {/* Game Header */}
                                    <div className="mb-8">
                                        <h3 className="text-xl font-bold text-[#8DA399] mb-2">The Missing Petal</h3>
                                        <p className="text-sm text-gray-400">Can you guess the missing word?</p>
                                    </div>

                                    {/* Idle State (Start Button) */}
                                    {gameData.status === 'idle' && !gameLoading && (
                                        <div className="py-12">
                                            <button 
                                                onClick={startChallenge}
                                                className="bg-[#5F7A6E] text-white px-8 py-4 rounded-xl text-xl font-bold hover:bg-[#4A6359] transition-transform hover:scale-105 shadow-md flex items-center gap-2 mx-auto"
                                            >
                                                <Icons.Puzzle size={24} /> Start Game
                                            </button>
                                        </div>
                                    )}

                                    {/* Loading State */}
                                    {gameLoading && (
                                        <div className="py-12">
                                            <div className="animate-spin inline-block w-8 h-8 border-4 border-[#8DA399] border-t-transparent rounded-full"></div>
                                            <p className="mt-4 text-gray-500">Finding a good question...</p>
                                        </div>
                                    )}

                                    {/* Playing State */}
                                    {(gameData.status === 'playing' || gameData.status === 'correct' || gameData.status === 'incorrect') && (
                                        <div className="fade-in">
                                            {/* The Sentence */}
                                            <div className="bg-stone-50 p-6 rounded-2xl mb-8 border-l-4 border-[#C29B82]">
                                                <p className="text-xl font-serif leading-relaxed text-gray-700">
                                                    "{gameData.question}"
                                                </p>
                                            </div>

                                            {/* Options */}
                                            <div className="grid grid-cols-2 gap-4 mb-8">
                                                {gameData.options.map((option, idx) => (
                                                    <button 
                                                        key={idx}
                                                        onClick={() => handleGameAnswer(option)}
                                                        disabled={gameData.status !== 'playing'}
                                                        className={`
                                                            p-4 rounded-xl font-bold transition-all border-2 
                                                            ${gameData.status === 'playing' 
                                                                ? 'bg-white border-stone-200 hover:border-[#8DA399] hover:bg-[#8DA399]/10' 
                                                                : ''
                                                            }
                                                            ${gameData.status !== 'playing' && option === gameData.targetWord 
                                                                ? 'bg-[#8DA399] text-white border-[#8DA399]' 
                                                                : ''
                                                            }
                                                            ${gameData.status === 'incorrect' && option !== gameData.targetWord 
                                                                ? 'opacity-50' 
                                                                : ''
                                                            }
                                                        `}
                                                    >
                                                        {option}
                                                    </button>
                                                ))}
                                            </div>

                                            {/* Feedback & Next Button */}
                                            {gameData.status === 'correct' && (
                                                <div className="animate-float">
                                                    <p className="text-[#8DA399] font-bold text-lg mb-4">Correct! You found the petal! üå±</p>
                                                    <button onClick={startChallenge} className="bg-[#EBC45D] text-white px-6 py-2 rounded-lg font-bold hover:bg-[#D4AF4D]">Next Question</button>
                                                </div>
                                            )}
                                            
                                            {gameData.status === 'incorrect' && (
                                                <div>
                                                    <p className="text-[#C29B82] font-bold text-lg mb-4">Oops! The correct word was "{gameData.targetWord}".</p>
                                                    <button onClick={startChallenge} className="bg-stone-400 text-white px-6 py-2 rounded-lg font-bold hover:bg-stone-500">Try Another</button>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                    </main>

                    {/* Footer / Reset */}
                    <footer className="mt-12 pt-8 border-t border-stone-200 flex justify-center">
                        <button 
                            onClick={resetProgress}
                            className="text-stone-400 hover:text-stone-600 text-sm flex items-center gap-1 transition-colors"
                        >
                            <Icons.RotateCcw size={14} /> Reset Garden
                        </button>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
